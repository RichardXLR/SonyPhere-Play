/*
 * Copyright (C) 2025 SonsPhere Project
 *
 * SPDX-License-Identifier: GPL-3.0
 */

package com.richard.musicplayer.ui.screens.settings

import androidx.compose.foundation.layout.*
import androidx.compose.foundation.lazy.LazyColumn
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.automirrored.rounded.ArrowBack
import androidx.compose.material3.*
import androidx.compose.runtime.*
import androidx.compose.ui.Modifier
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp
import androidx.navigation.NavController
import com.richard.musicplayer.LocalPlayerAwareWindowInsets
import com.richard.musicplayer.ui.component.IconButton
import com.richard.musicplayer.ui.utils.backToMain

@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun OpenSourceLicensesScreen(
    navController: NavController,
    scrollBehavior: TopAppBarScrollBehavior,
) {
    Column(
        modifier = Modifier
            .fillMaxSize()
            .windowInsetsPadding(LocalPlayerAwareWindowInsets.current)
    ) {
        TopAppBar(
            title = { 
                Text(
                    "‚öñÔ∏è Licen√ßas Open Source",
                    style = MaterialTheme.typography.headlineSmall.copy(
                        fontWeight = FontWeight.Bold
                    )
                )
            },
            navigationIcon = {
                IconButton(
                    onClick = navController::backToMain
                ) {
                    Icon(
                        Icons.AutoMirrored.Rounded.ArrowBack,
                        contentDescription = "Voltar"
                    )
                }
            },
            scrollBehavior = scrollBehavior
        )

        LazyColumn(
            modifier = Modifier.fillMaxSize(),
            contentPadding = PaddingValues(16.dp),
            verticalArrangement = Arrangement.spacedBy(16.dp)
        ) {
            item {
                LicenseCard(
                    title = "Compromisso com Open Source",
                    emoji = "üåü"
                ) {
                    Text(
                        "O SonsPhere √© constru√≠do sobre a base s√≥lida de projetos open source. Reconhecemos e agradecemos a todos os desenvolvedores e comunidades que tornaram este aplicativo poss√≠vel.",
                        style = MaterialTheme.typography.bodyLarge,
                        lineHeight = 24.sp
                    )
                }
            }

            item {
                LicenseCard(
                    title = "SonsPhere - GPL 3.0",
                    emoji = "üß©"
                ) {
                    Column(verticalArrangement = Arrangement.spacedBy(8.dp)) {
                        Text(
                            "O SonsPhere est√° licenciado sob GPL 3.0:",
                            style = MaterialTheme.typography.bodyMedium.copy(fontWeight = FontWeight.Medium)
                        )
                        
                        LicenseBulletPoint("C√≥digo fonte aberto e dispon√≠vel")
                        LicenseBulletPoint("Liberdade para usar, modificar e distribuir")
                        LicenseBulletPoint("Copyleft forte - derivados devem ser GPL")
                        LicenseBulletPoint("Prote√ß√£o contra patents e DRM")
                        
                        Text(
                            "üìÅ C√≥digo fonte: github.com/richard-dev/sonpsphere",
                            style = MaterialTheme.typography.bodySmall,
                            color = MaterialTheme.colorScheme.primary
                        )
                    }
                }
            }

            item {
                LicenseCard(
                    title = "Jetpack Compose - Apache 2.0",
                    emoji = "üé®"
                ) {
                    Column(verticalArrangement = Arrangement.spacedBy(8.dp)) {
                        Text(
                            "Copyright ¬© 2021 The Android Open Source Project",
                            style = MaterialTheme.typography.bodySmall.copy(fontWeight = FontWeight.Medium)
                        )
                        
                        Text(
                            "Framework moderno para interface de usu√°rio Android que revolucionou o desenvolvimento mobile.",
                            style = MaterialTheme.typography.bodyMedium
                        )
                        
                        Text(
                            "üîó developer.android.com/jetpack/compose",
                            style = MaterialTheme.typography.bodySmall,
                            color = MaterialTheme.colorScheme.primary
                        )
                    }
                }
            }

            item {
                LicenseCard(
                    title = "Kotlin - Apache 2.0",
                    emoji = "‚ö°"
                ) {
                    Column(verticalArrangement = Arrangement.spacedBy(8.dp)) {
                        Text(
                            "Copyright ¬© 2010-2023 JetBrains s.r.o. and Kotlin Programming Language contributors",
                            style = MaterialTheme.typography.bodySmall.copy(fontWeight = FontWeight.Medium)
                        )
                        
                        Text(
                            "Linguagem de programa√ß√£o moderna, concisa e segura que potencializa o desenvolvimento Android.",
                            style = MaterialTheme.typography.bodyMedium
                        )
                        
                        Text(
                            "üîó kotlinlang.org",
                            style = MaterialTheme.typography.bodySmall,
                            color = MaterialTheme.colorScheme.primary
                        )
                    }
                }
            }

            item {
                LicenseCard(
                    title = "Material Design Components - Apache 2.0",
                    emoji = "üéØ"
                ) {
                    Column(verticalArrangement = Arrangement.spacedBy(8.dp)) {
                        Text(
                            "Copyright ¬© 2016 Google Inc.",
                            style = MaterialTheme.typography.bodySmall.copy(fontWeight = FontWeight.Medium)
                        )
                        
                        Text(
                            "Sistema de design que proporciona experi√™ncias digitais coesas e intuitivas.",
                            style = MaterialTheme.typography.bodyMedium
                        )
                        
                        Text(
                            "üîó material.io",
                            style = MaterialTheme.typography.bodySmall,
                            color = MaterialTheme.colorScheme.primary
                        )
                    }
                }
            }

            item {
                LicenseCard(
                    title = "ExoPlayer - Apache 2.0",
                    emoji = "üéµ"
                ) {
                    Column(verticalArrangement = Arrangement.spacedBy(8.dp)) {
                        Text(
                            "Copyright ¬© 2016 Google Inc.",
                            style = MaterialTheme.typography.bodySmall.copy(fontWeight = FontWeight.Medium)
                        )
                        
                        Text(
                            "Player de m√≠dia avan√ßado para Android que oferece reprodu√ß√£o de alta qualidade e recursos extensos.",
                            style = MaterialTheme.typography.bodyMedium
                        )
                        
                        Text(
                            "üîó github.com/google/ExoPlayer",
                            style = MaterialTheme.typography.bodySmall,
                            color = MaterialTheme.colorScheme.primary
                        )
                    }
                }
            }

            item {
                LicenseCard(
                    title = "Room Database - Apache 2.0",
                    emoji = "üóÑÔ∏è"
                ) {
                    Column(verticalArrangement = Arrangement.spacedBy(8.dp)) {
                        Text(
                            "Copyright ¬© 2017 The Android Open Source Project",
                            style = MaterialTheme.typography.bodySmall.copy(fontWeight = FontWeight.Medium)
                        )
                        
                        Text(
                            "Biblioteca de persist√™ncia que fornece uma camada de abstra√ß√£o sobre SQLite.",
                            style = MaterialTheme.typography.bodyMedium
                        )
                        
                        Text(
                            "üîó developer.android.com/training/data-storage/room",
                            style = MaterialTheme.typography.bodySmall,
                            color = MaterialTheme.colorScheme.primary
                        )
                    }
                }
            }

            item {
                LicenseCard(
                    title = "Hilt Dependency Injection - Apache 2.0",
                    emoji = "üíâ"
                ) {
                    Column(verticalArrangement = Arrangement.spacedBy(8.dp)) {
                        Text(
                            "Copyright ¬© 2020 The Android Open Source Project",
                            style = MaterialTheme.typography.bodySmall.copy(fontWeight = FontWeight.Medium)
                        )
                        
                        Text(
                            "Framework de inje√ß√£o de depend√™ncia constru√≠do sobre Dagger para aplica√ß√µes Android.",
                            style = MaterialTheme.typography.bodyMedium
                        )
                        
                        Text(
                            "üîó dagger.dev/hilt",
                            style = MaterialTheme.typography.bodySmall,
                            color = MaterialTheme.colorScheme.primary
                        )
                    }
                }
            }

            item {
                LicenseCard(
                    title = "Coil Image Loading - Apache 2.0",
                    emoji = "üñºÔ∏è"
                ) {
                    Column(verticalArrangement = Arrangement.spacedBy(8.dp)) {
                        Text(
                            "Copyright ¬© 2023 Coil Contributors",
                            style = MaterialTheme.typography.bodySmall.copy(fontWeight = FontWeight.Medium)
                        )
                        
                        Text(
                            "Biblioteca de carregamento de imagens para Android, constru√≠da com Kotlin Coroutines.",
                            style = MaterialTheme.typography.bodyMedium
                        )
                        
                        Text(
                            "üîó coil-kt.github.io/coil",
                            style = MaterialTheme.typography.bodySmall,
                            color = MaterialTheme.colorScheme.primary
                        )
                    }
                }
            }

            item {
                LicenseCard(
                    title = "Kotlin Coroutines - Apache 2.0",
                    emoji = "üîÑ"
                ) {
                    Column(verticalArrangement = Arrangement.spacedBy(8.dp)) {
                        Text(
                            "Copyright ¬© 2016-2023 JetBrains s.r.o.",
                            style = MaterialTheme.typography.bodySmall.copy(fontWeight = FontWeight.Medium)
                        )
                        
                        Text(
                            "Biblioteca para programa√ß√£o ass√≠ncrona e reativa em Kotlin.",
                            style = MaterialTheme.typography.bodyMedium
                        )
                        
                        Text(
                            "üîó github.com/Kotlin/kotlinx.coroutines",
                            style = MaterialTheme.typography.bodySmall,
                            color = MaterialTheme.colorScheme.primary
                        )
                    }
                }
            }

            item {
                LicenseCard(
                    title = "OuterTune Project - GPL 3.0",
                    emoji = "üöÄ"
                ) {
                    Column(verticalArrangement = Arrangement.spacedBy(8.dp)) {
                        Text(
                            "Agradecimento especial ao projeto OuterTune que serviu como base e inspira√ß√£o:",
                            style = MaterialTheme.typography.bodyMedium.copy(fontWeight = FontWeight.Medium)
                        )
                        
                        LicenseBulletPoint("Arquitetura s√≥lida e bem estruturada")
                        LicenseBulletPoint("Implementa√ß√µes de refer√™ncia")
                        LicenseBulletPoint("Comunidade ativa e colaborativa")
                        LicenseBulletPoint("C√≥digo limpo e bem documentado")
                        
                        Text(
                            "üîó github.com/DD3Boh/OuterTune",
                            style = MaterialTheme.typography.bodySmall,
                            color = MaterialTheme.colorScheme.primary
                        )
                    }
                }
            }

            item {
                LicenseCard(
                    title = "Licen√ßa Apache 2.0 - Resumo",
                    emoji = "üìÑ"
                ) {
                    Column(verticalArrangement = Arrangement.spacedBy(8.dp)) {
                        Text(
                            "A maioria das bibliotecas usa Apache 2.0, que permite:",
                            style = MaterialTheme.typography.bodyMedium.copy(fontWeight = FontWeight.Medium)
                        )
                        
                        LicenseBulletPoint("Uso comercial e n√£o comercial")
                        LicenseBulletPoint("Modifica√ß√£o e distribui√ß√£o")
                        LicenseBulletPoint("Uso de patentes dos contribuidores")
                        LicenseBulletPoint("Sublicenciamento permitido")
                        LicenseBulletPoint("Atribui√ß√£o obrigat√≥ria")
                    }
                }
            }

            item {
                LicenseCard(
                    title = "Licen√ßa GPL 3.0 - Resumo",
                    emoji = "‚öñÔ∏è"
                ) {
                    Column(verticalArrangement = Arrangement.spacedBy(8.dp)) {
                        Text(
                            "O SonsPhere usa GPL 3.0, garantindo:",
                            style = MaterialTheme.typography.bodyMedium.copy(fontWeight = FontWeight.Medium)
                        )
                        
                        LicenseBulletPoint("Software livre para sempre")
                        LicenseBulletPoint("C√≥digo fonte sempre dispon√≠vel")
                        LicenseBulletPoint("Derivados devem ser GPL 3.0")
                        LicenseBulletPoint("Prote√ß√£o contra tivoization")
                        LicenseBulletPoint("Compatibilidade com outras licen√ßas livres")
                    }
                }
            }

            item {
                Card(
                    modifier = Modifier.fillMaxWidth(),
                    shape = RoundedCornerShape(16.dp),
                    colors = CardDefaults.cardColors(
                        containerColor = MaterialTheme.colorScheme.tertiaryContainer.copy(alpha = 0.3f)
                    )
                ) {
                    Column(
                        modifier = Modifier.padding(20.dp),
                        verticalArrangement = Arrangement.spacedBy(12.dp)
                    ) {
                        Text(
                            "üíù Agradecimentos",
                            style = MaterialTheme.typography.titleMedium.copy(
                                fontWeight = FontWeight.Bold
                            )
                        )
                        
                        Text(
                            "Nosso sincero agradecimento a todos os desenvolvedores, mantenedores e comunidades que criaram e mant√™m estas bibliotecas incr√≠veis. Sem voc√™s, o SonsPhere n√£o seria poss√≠vel.",
                            style = MaterialTheme.typography.bodyMedium,
                            lineHeight = 22.sp
                        )
                        
                        Text(
                            "O software livre √© a base da inova√ß√£o tecnol√≥gica! üåç‚ú®",
                            style = MaterialTheme.typography.bodyMedium.copy(
                                fontWeight = FontWeight.Medium
                            ),
                            color = MaterialTheme.colorScheme.primary
                        )
                    }
                }
            }

            item {
                Card(
                    modifier = Modifier.fillMaxWidth(),
                    shape = RoundedCornerShape(16.dp),
                    colors = CardDefaults.cardColors(
                        containerColor = MaterialTheme.colorScheme.errorContainer.copy(alpha = 0.1f)
                    )
                ) {
                    Column(
                        modifier = Modifier.padding(20.dp),
                        verticalArrangement = Arrangement.spacedBy(8.dp)
                    ) {
                        Text(
                            "‚ö†Ô∏è Avisos Legais",
                            style = MaterialTheme.typography.titleMedium.copy(
                                fontWeight = FontWeight.Bold
                            )
                        )
                        
                        Text(
                            "‚Ä¢ Todas as licen√ßas s√£o respeitadas integralmente",
                            style = MaterialTheme.typography.bodySmall
                        )
                        Text(
                            "‚Ä¢ Textos completos dispon√≠veis nos reposit√≥rios originais",
                            style = MaterialTheme.typography.bodySmall
                        )
                        Text(
                            "‚Ä¢ Atribui√ß√µes mantidas conforme requerido",
                            style = MaterialTheme.typography.bodySmall
                        )
                        Text(
                            "‚Ä¢ Conformidade com obriga√ß√µes de cada licen√ßa",
                            style = MaterialTheme.typography.bodySmall
                        )
                    }
                }
            }

            item { Spacer(modifier = Modifier.height(32.dp)) }
        }
    }
}

@Composable
private fun LicenseCard(
    title: String,
    emoji: String,
    content: @Composable () -> Unit
) {
    Card(
        modifier = Modifier.fillMaxWidth(),
        shape = RoundedCornerShape(16.dp),
        colors = CardDefaults.cardColors(
            containerColor = MaterialTheme.colorScheme.surface
        )
    ) {
        Column(
            modifier = Modifier.padding(20.dp),
            verticalArrangement = Arrangement.spacedBy(12.dp)
        ) {
            Row {
                Text(
                    text = emoji,
                    fontSize = 24.sp
                )
                Spacer(modifier = Modifier.width(12.dp))
                Text(
                    text = title,
                    style = MaterialTheme.typography.titleLarge.copy(
                        fontWeight = FontWeight.Bold
                    )
                )
            }
            content()
        }
    }
}

@Composable
private fun LicenseBulletPoint(text: String) {
    Row {
        Text(
            text = "‚Ä¢ ",
            style = MaterialTheme.typography.bodyMedium,
            color = MaterialTheme.colorScheme.primary
        )
        Text(
            text = text,
            style = MaterialTheme.typography.bodyMedium,
            modifier = Modifier.weight(1f)
        )
    }
} 